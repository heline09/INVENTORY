<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>Issue Equipment</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

	<style type="text/css">
		/* dropdown CSS */
		#search-results {
			display: none;
			position: absolute;
			background-color: white;
			border: 1px solid #ccc;
			z-index: 1000;
			width: 100%;
			max-height: 200px;
			overflow-y: auto;
		}

		.dropdown-item {
			padding: 10px;
			cursor: pointer;
		}

		.dropdown-item:hover {
			background-color: #f1f1f1;
		}

		body {
			color: #aa082e;
			background: #e2ddde;
			font-family: 'Roboto', sans-serif;
		}

		.form-control {
			border-color: #eee;
			min-height: 41px;
			box-shadow: none !important;
		}

		.form-control:focus {
			border-color: #5cd3b4;
		}

		.form-control,
		.btn {
			border-radius: 3px;
		}

		.signup-form {
			width: 500px;
			margin: 0 auto;
			padding: 30px 0;
		}

		.signup-form h2 {
			color: #333;
			margin: 0 0 30px 0;
			display: inline-block;
			padding: 0 30px 10px 0;
			border-bottom: 3px solid #ffffff;
		}

		.signup-form form {
			color: #999;
			border-radius: 3px;
			margin-bottom: 15px;
			background: #fff;
			box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.3);
			padding: 30px;
		}

		.signup-form .form-group {
			margin-bottom: 20px;
		}

		.signup-form label {
			font-weight: normal;
			font-size: 13px;
		}

		.signup-form input[type="checkbox"] {
			margin-top: 2px;
		}

		.signup-form .btn {
			font-size: 16px;
			font-weight: bold;
			background: #161df0;
			border: none;
			margin-top: 20px;
			min-width: 140px;
		}

		.signup-form .btn:hover,
		.signup-form .btn:focus {
			background: #41cba9;
			outline: none !important;
		}

		.signup-form a {
			color: #2b04ff;

			text-decoration: underline;
		}

		.signup-form a:hover {
			text-decoration: none;
		}

		.signup-form form a {
			color: #5cd3b4;
			text-decoration: none;
		}

		.signup-form form a:hover {
			text-decoration: underline;
		}
	</style>
</head>

<body>
	{% include "library/navbaradmin.html" %}
	<br><br><br>
	<div class="signup-form">
		<form method="post" class="form-horizontal">
			<h1 style="color: black;">
				BORROW FORM
			</h1>
			{% csrf_token %}
			<div class="form-group">
				<label for="search-input">Search Student:</label>
				<input type="text" id="search-input" class="form-control" placeholder="Search student by name or ID"
					autocomplete="off">
				<div id="search-results" class="dropdown-menu" style="display: none; position: absolute; width: 100%;">
				</div>
			</div>
			<div id="no-students" style="display: none;">No students found</div>

			<div class="form-group">
				<label for="search-input">Search Equipment:</label>
				<input type="text" id="search-input" class="form-control" placeholder="Search equipment by name or ID"
					autocomplete="off">
				<div id="search-results" class="dropdown-menu" style="display: none; position: absolute; width: 100%;">
				</div>
				<div id="no-equipment" style="display: none;">No equipment found</div>

				{% for field in form %}
				<div class="form-group">
					<label class="control-label col-xs-4">{{ field.label_tag }}</label>
					<div class="col-xs-8">
						{{ field }}
					</div>
				</div>
				{% endfor %}


				<div class="form-group">
					<div class="col-xs-8 col-xs-offset-4">
						<button type="submit" class="btn btn-primary btn-lg">ISSUE</button>
					</div>
				</div>
		</form>
		<div class="text-center">View Issued Equipment to Student <a href="{% url 'assigned_equipment' %}">Click
				here</a></div>
	</div>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const searchInputElement = document.getElementById('search-input');
			const searchResultsElement = document.getElementById('search-results');
			const noStudentsElement = document.getElementById('no-students');

			searchInputElement.addEventListener('input', performSearch);

			function performSearch() {
				const searchTerm = searchInputElement.value.toLowerCase();

				if (searchTerm.length < 2) {
					searchResultsElement.style.display = 'none';
					noStudentsElement.style.display = 'none';
					return;
				}

				fetch(`/search_students/?search_term=${searchTerm}`)
					.then(response => response.json())
					.then(data => {
						searchResultsElement.innerHTML = '';

						if (data.length > 0) {
							data.forEach(student => {
								const div = document.createElement('div');
								div.className = 'dropdown-item';
								div.textContent = `${student.first_name} ${student.last_name} (${student.student_id})`;
								div.addEventListener('click', () => selectStudent(student));
								searchResultsElement.appendChild(div);
							});
							searchResultsElement.style.display = 'block';
							noStudentsElement.style.display = 'none';
						} else {
							searchResultsElement.style.display = 'none';
							noStudentsElement.style.display = 'block';
						}
					});
			}

			function selectStudent(student) {
				document.getElementById('id_student_first_name').value = student.first_name;
				document.getElementById('id_student_last_name').value = student.last_name;
				document.getElementById('id_student_id').value = student.student_id;

				searchInputElement.value = '';
				searchResultsElement.style.display = 'none';
				noStudentsElement.style.display = 'none';
			}

			document.addEventListener('click', function (event) {
				if (!searchInputElement.contains(event.target) && !searchResultsElement.contains(event.target)) {
					searchResultsElement.style.display = 'none';
				}
			});
		});
	</script>





	{% include "library/footer.html" %}
</body>

</html>